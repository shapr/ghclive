<html>
  <head>
    <title>hint evaluator page</title>
    <link rel="stylesheet" type="text/css" href="static/style.css" media="screen">
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/jquery.console.js"></script>
    <script type="text/javascript" src="static/hintconsole.js"></script>
    <!-- sharejs + codemirror -->
    <link rel="stylesheet" href="http://c-71-207-252-122.hsd1.al.comcast.net:8000/lib/cm/lib/codemirror.css">
    <script type="text/javascript">
      

    </script>
  </head>
  <body>
    <!-- I wouldn't call it pretty, but it does work -->
    <form action="/hint" method="get">
      <input type="text" id="fileurl" name="fileurl"/>File to load<br/>
      <input id="testclick" type="button" value="tesclick"/>
    </form>

<div id="header">
  <div id="htext">
    <b>Editing</b> <input type="text" value="cm" id='namefield'>
  </div>
</div>

    <script src="http://c-71-207-252-122.hsd1.al.comcast.net:8000/lib/cm/lib/codemirror.js"></script>
    <script src="http://c-71-207-252-122.hsd1.al.comcast.net:8000/lib/cm/mode/haskell/haskell.js"></script>
    <script src="http://c-71-207-252-122.hsd1.al.comcast.net:8000/channel/bcsocket.js"></script>
    <script src="http://c-71-207-252-122.hsd1.al.comcast.net:8000/share/share.uncompressed.js"></script>
    <script src="http://c-71-207-252-122.hsd1.al.comcast.net:8000/share/cm.js"></script>
<form id="source">
  <textarea id="editor" class="editor" name="editor" > This should be the editor widget </textarea>
  <input id="load" type="button" value="Load Module"/>
</form>

    <script>
var doc = null, editor = null;

function setDoc(docName) {
  document.title = docName;

  sharejs.open(docName, 'text', 'http://c-71-207-252-122.hsd1.al.comcast.net:8000/channel', function(error, newDoc) {
      if (doc !== null) {
          doc.close();
          doc.detach_ace();
      }

      doc = newDoc;

      if (error) {
          console.error(error);
          return;
      }
      doc.attach_cm(editor);
  });
};

window.onload = function() {
  var ed = document.getElementById('editor');
  //editor = CodeMirror(document.body, { mode: "haskell", tabSize: 2 });
  editor = CodeMirror.fromTextArea(document.getElementById('editor'), {
    mode: "haskell", 
    tabSize: 2,
    lineNumbers:true,
    indentUnit: 4,
    matchBrackets: true
  });

  setDoc('cm');  // Hooking ShareJS and CodeMirror for the first time.

  var namefield = document.getElementById('namefield');
  function fn() {
      var docName = namefield.value;
      if (docName) setDoc(docName);
  }

  if (namefield.addEventListener) {
      namefield.addEventListener('input', fn, false);
  } else {
      namefield.attachEvent('oninput', fn);
  }
};
      $("#testclick").click(function() {
      alert("Handler for #load.click() called");
      });

      $("#load").click(function() {
         $("#editor").val(editor.getValue());
         var serData = $("#source").serialize();
         // alert(serData);
         $.post('/load', serData, function (data) {
           alert(data);
         });
         return false;
      });
    </script>
<!-- end sharejs + codemirror -->

  </body>
</html>
